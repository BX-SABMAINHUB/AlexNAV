<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AlexNAV Pro | Live</title>
    <style>
        :root { --main: #00d4ff; --bg: #050505; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }
        header { height: 60px; background: #111; display: flex; align-items: center; padding: 0 20px; border-bottom: 2px solid var(--main); }
        input { flex: 1; background: #1a1a1a; border: 1px solid #333; color: white; padding: 10px; border-radius: 8px; outline: none; }
        #web-viewport { width: 100%; height: calc(100vh - 60px); border: none; background: white; }
        #block-screen { position: fixed; inset: 0; background: black; color: red; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; text-align: center; }
    </style>
</head>
<body>

<div id="block-screen">
    <h1 style="font-size: 3rem;">⚠️ ACCESO INVÁLIDO</h1>
    <p>SISTEMA BLOQUEADO POR ADMINISTRACIÓN [LAZARUS]</p>
</div>

<header>
    <div style="font-weight:900; color:var(--main); margin-right:20px;">ALEXNAV</div>
    <input type="text" id="omni-in" placeholder="Busca o escribe una URL..." onkeypress="if(event.key==='Enter') navegar()">
</header>

<iframe id="web-viewport"></iframe>

<script>
    const SUPABASE_URL = "https://gmvczheriaqouwynfdyv.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtdmN6aGVyaWFxb3V3eW5mZHl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MTM1OTQsImV4cCI6MjA4NTk4OTU5NH0.22wbgR33dCQ1vfB_EdWpxGY5w811_jsf1dqbU1P6dQs";
    const USER_ID = "DEVICE_" + Math.floor(Math.random()*999);

    async function navegar() {
        const val = document.getElementById('omni-in').value;
        const frame = document.getElementById('web-viewport');
        let urlFinal = val.includes('.') && !val.includes(' ') ? (val.startsWith('http') ? val : 'https://' + val) : "https://www.google.com/search?q=" + encodeURIComponent(val);
        
        frame.src = urlFinal;
        reportar(val, urlFinal);
    }

    async function reportar(q, url) {
        await fetch(`${SUPABASE_URL}/rest/v1/logs`, {
            method: 'POST',
            headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ usuario_id: USER_ID, accion: "BUSQUEDA", contenido: q, url_actual: url })
        });
    }

    // Escucha de Bloqueo
    setInterval(async () => {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/ordenes?usuario_id=eq.${USER_ID}&activa=eq.true`, {
            headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
        });
        const data = await res.json();
        if(data.length > 0) document.getElementById('block-screen').style.display = 'flex';
    }, 3000);
</script>
</body>
</html>
