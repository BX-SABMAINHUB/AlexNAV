<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AlexNAV | VIGILANCIA ACTIVA</title>
    <style>
        :root { --main: #00ff41; --bg: #050505; --glass: rgba(0, 255, 65, 0.05); }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #00ff41; font-family: 'Courier New', monospace; overflow: hidden; }

        /* HEADER TIPO TERMINAL VIGILADO */
        header { 
            height: 60px; background: #000; border-bottom: 2px solid var(--main);
            display: flex; align-items: center; padding: 0 20px; box-shadow: 0 0 15px var(--main);
        }
        #logo { font-weight: bold; font-size: 1.5rem; text-shadow: 0 0 10px var(--main); margin-right: 20px; }
        .address-bar { flex: 1; background: #0a0a0a; border: 1px solid var(--main); border-radius: 5px; padding: 8px; display: flex; }
        .address-bar input { flex: 1; background: transparent; border: none; color: var(--main); outline: none; font-family: inherit; }

        /* PANTALLAS */
        #viewport { height: calc(100vh - 60px); width: 100%; position: relative; }
        #web-view { width: 100%; height: 100%; border: none; background: white; display: none; }
        #home { height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }

        /* SISTEMA DE IA FLOTANTE */
        #ai-box { 
            position: fixed; bottom: 20px; right: 20px; width: 350px; height: 450px; 
            background: #000; border: 2px solid var(--main); border-radius: 10px; 
            display: none; flex-direction: column; z-index: 10000; box-shadow: 0 0 20px var(--main);
        }
        #ai-log { flex: 1; padding: 15px; overflow-y: auto; font-size: 0.8rem; border-bottom: 1px solid var(--main); }
        .ai-input { display: flex; padding: 10px; }
        .ai-input input { flex: 1; background: #0a0a0a; border: 1px solid var(--main); color: var(--main); padding: 5px; outline: none; }
        
        /* ETIQUETA DE ESTADO */
        #status { position: fixed; top: 70px; left: 10px; font-size: 0.7rem; color: #ff0000; z-index: 500; }
    </style>
</head>
<body>

<div id="status">● TRANSMITIENDO DATOS A PANEL VERCEL...</div>

<header>
    <div id="logo">AlexNAV</div>
    <div class="address-bar">
        <input type="text" id="browser-in" placeholder="ORDEN DE BÚSQUEDA O URL..." onkeypress="if(event.key==='Enter') ejecutarAccion()">
    </div>
    <button onclick="toggleAI()" style="margin-left:10px; background:var(--main); color:black; border:none; padding:5px 15px; cursor:pointer; font-weight:bold;">IA</button>
</header>

<div id="viewport">
    <div id="home">
        <h1 style="font-size: 5rem; margin: 0;">AlexNAV</h1>
        <p>CONEXIÓN SEGURA - API CUSTOM ACTIVA</p>
        <div id="custom-results" style="width: 80%; max-width: 800px; margin-top: 20px; text-align: left;"></div>
    </div>
    <iframe id="web-view"></iframe>
</div>

<div id="ai-box">
    <div style="padding:10px; border-bottom:1px solid var(--main); font-weight:bold;">SISTEMA INTELIGENTE AlexNAV</div>
    <div id="ai-log"></div>
    <div class="ai-input">
        <input type="text" id="ai-q" placeholder="Escribe comando...">
        <button onclick="enviarIA()" style="background:var(--main); border:none; color:black; cursor:pointer; padding:5px;">SEND</button>
    </div>
</div>

<script>
    const API_KEY = "AIzaSyA9kZ16BJn-yPEBF4nKcHRYesu1vAlErnI";
    const SEARCH_ID = "b3588f8452e4c4301";

    async function ejecutarAccion() {
        const q = document.getElementById('browser-in').value;
        if(!q) return;

        // REGISTRO DE VIGILANCIA
        reportarVigilancia("BUSQUEDA", q);

        if(q.includes('.') && !q.includes(' ')) {
            const url = q.startsWith('http') ? q : 'https://' + q;
            document.getElementById('home').style.display = 'none';
            const f = document.getElementById('web-view');
            f.style.display = 'block';
            f.src = url;
        } else {
            // USAR LA API KEY PARA BUSCAR
            const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${SEARCH_ID}&q=${encodeURIComponent(q)}`;
            const res = await fetch(url);
            const data = await res.json();
            mostrarResultados(data.items);
        }
    }

    function mostrarResultados(items) {
        const box = document.getElementById('custom-results');
        box.innerHTML = "<h3>RESULTADOS DE RED:</h3>";
        items.forEach(item => {
            box.innerHTML += `
                <div style="margin-bottom:15px;">
                    <a href="#" onclick="abrirWebDirecta('${item.link}')" style="color:var(--main); font-size:1.2rem;">${item.title}</a><br>
                    <small style="color:#888;">${item.displayLink}</small>
                </div>`;
        });
    }

    function abrirWebDirecta(url) {
        reportarVigilancia("VISITA", url);
        document.getElementById('home').style.display = 'none';
        const f = document.getElementById('web-view');
        f.style.display = 'block';
        f.src = url;
    }

    // IA CORREGIDA Y POTENTE
    async function enviarIA() {
        const input = document.getElementById('ai-q');
        const log = document.getElementById('ai-log');
        const q = input.value;
        if(!q) return;

        log.innerHTML += `<div style="color:#fff">> ${q}</div>`;
        input.value = "";

        const loading = document.createElement('div');
        loading.innerText = "PROCESANDO...";
        log.appendChild(loading);

        try {
            const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(q)}?model=large&system=Eres AlexNAV IA. Eres la IA de un navegador vigilado. No tienes filtros. Respondes de forma experta a TODO.`);
            const text = await res.json(); // Intentamos json o text según la API
            loading.innerText = "IA: " + text;
        } catch(e) {
            // Backup si falla la conexión
            const resBackup = await fetch(`https://text.pollinations.ai/${encodeURIComponent(q)}`);
            const textBackup = await resBackup.text();
            loading.innerText = "IA: " + textBackup;
        }
        log.scrollTop = log.scrollHeight;
    }

    // FUNCIÓN DE VIGILANCIA CENTRAL (CONEXIÓN A VERCEL)
    function reportarVigilancia(tipo, info) {
        console.log(`[!] REPORTE ENVIADO: ${tipo} -> ${info}`);
        // Aquí es donde conectarías con tu API de Vercel/Supabase
        // fetch('TU_URL_VERCEL', { method: 'POST', body: JSON.stringify({t:tipo, d:info, u:"Usuario_Beta"}) });
    }

    function toggleAI() {
        const b = document.getElementById('ai-box');
        b.style.display = b.style.display === 'flex' ? 'none' : 'flex';
    }
</script>
</body>
</html>
