<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AlexNAV Quantum | Next-Gen Browser</title>
    <style>
        :root { --accent: #00d4ff; --bg: #030305; --panel: rgba(20, 20, 25, 0.85); --text: #e0e0e0; }
        * { box-sizing: border-box; transition: all 0.2s ease; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; overflow: hidden; }

        /* UI DE NAVEGADOR PROFESIONAL */
        .browser-chrome { height: 75px; background: var(--panel); backdrop-filter: blur(25px); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; padding: 0 20px; gap: 15px; z-index: 100; position: relative; }
        .nav-group { display: flex; gap: 8px; }
        .btn-circle { width: 38px; height: 38px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .btn-circle:hover { background: var(--accent); color: #000; box-shadow: 0 0 15px var(--accent); }
        
        .omni-box { flex: 1; position: relative; display: flex; align-items: center; }
        .omni-input { width: 100%; background: #0a0a0c; border: 1px solid #333; color: #fff; padding: 12px 20px; border-radius: 30px; outline: none; font-size: 14px; padding-left: 45px; border: 1px solid transparent; }
        .omni-input:focus { border-color: var(--accent); background: #000; box-shadow: inset 0 0 10px rgba(0, 212, 255, 0.1); }
        .omni-icon { position: absolute; left: 15px; color: var(--accent); font-size: 18px; }

        /* SIDEBAR DE AJUSTES OCULTO */
        #settings-menu { position: fixed; right: -300px; top: 75px; width: 300px; height: calc(100% - 75px); background: var(--panel); backdrop-filter: blur(30px); border-left: 1px solid rgba(255,255,255,0.1); padding: 30px; z-index: 99; }
        #settings-menu.open { right: 0; }
        .setting-item { margin-bottom: 25px; }
        .setting-item label { display: block; margin-bottom: 10px; font-size: 12px; color: var(--accent); text-transform: uppercase; }

        /* VIEWPORT */
        #viewport-container { width: 100%; height: calc(100vh - 75px); background: #fff; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }

        /* OVERLAYS DE VIGILANCIA (INVISIBLE PARA EL USUARIO HASTA QUE SE ACTIVA) */
        .lazarus-system { position: fixed; inset: 0; z-index: 200000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        #ban-overlay { background: radial-gradient(circle, #ff0000, #440000); color: white; }
        #mute-overlay { background: #000; color: var(--accent); }
        #msg-overlay { background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); }
        .msg-box { background: #111; border: 2px solid var(--accent); padding: 40px; border-radius: 20px; text-align: center; max-width: 80%; }
        
        /* ANIMACIONES */
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .loading-bar { position: absolute; bottom: 0; left: 0; height: 2px; background: var(--accent); width: 0%; transition: width 0.4s; }
    </style>
</head>
<body>

<div id="ban-overlay" class="lazarus-system">
    <h1 style="font-size: 5rem; margin: 0;">DISPOSITIVO BLOQUEADO</h1>
    <p style="font-size: 1.5rem;">SISTEMA LAZARUS - ADMINISTRADOR: ALEX</p>
</div>

<div id="mute-overlay" class="lazarus-system">
    <h1>MODO LECTURA OBLIGATORIO</h1>
    <p>TIEMPO RESTANTE DE MUTE:</p>
    <div id="timer" style="font-size: 6rem; font-weight: bold;">00:00</div>
</div>

<div id="msg-overlay" class="lazarus-system">
    <div class="msg-box">
        <h2 style="color: var(--accent);">MENSAJE DEL ADMINISTRADOR</h2>
        <p id="admin-msg-text" style="font-size: 1.5rem;"></p>
        <button class="btn-circle" style="width: auto; padding: 0 30px; border-radius: 10px; margin-top: 20px;" onclick="document.getElementById('msg-overlay').style.display='none'">ENTENDIDO</button>
    </div>
</div>

<header class="browser-chrome">
    <div class="nav-group">
        <button class="btn-circle" onclick="document.getElementById('web-viewer').contentWindow.history.back()">‚Üê</button>
        <button class="btn-circle" onclick="document.getElementById('web-viewer').contentWindow.history.forward()">‚Üí</button>
        <button class="btn-circle" onclick="reloadFrame()">‚ü≥</button>
        <button class="btn-circle" onclick="goHome()">üè†</button>
    </div>
    
    <div class="omni-box">
        <span class="omni-icon">üîç</span>
        <input type="text" id="omni-bar" class="omni-input" placeholder="Introduce una URL o busca en la red de AlexNAV..." onkeypress="if(event.key==='Enter') executeNav()">
        <div id="load-progress" class="loading-bar"></div>
    </div>

    <div class="nav-group">
        <button class="btn-circle" onclick="toggleSettings()">‚öôÔ∏è</button>
    </div>
</header>

<div id="settings-menu">
    <h3>Configuraci√≥n</h3>
    <div class="setting-item">
        <label>Motor de B√∫squeda</label>
        <select style="width:100%; background:#111; color:white; border:1px solid #444; padding:8px;">
            <option>Google (Default)</option>
            <option>AlexNAV Private Search</option>
            <option>DuckDuckGo</option>
        </select>
    </div>
    <div class="setting-item">
        <label>Privacidad</label>
        <div style="display:flex; justify-content:space-between;">
            <span>Modo Inc√≥gnito</span>
            <input type="checkbox" checked>
        </div>
    </div>
</div>

<div id="viewport-container">
    <iframe id="web-viewer" src="https://www.google.com/search?igu=1"></iframe>
</div>

<script>
    const SB_URL = "https://gmvczheriaqouwynfdyv.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtdmN6aGVyaWFxb3V3eW5mZHl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MTM1OTQsImV4cCI6MjA4NTk4OTU5NH0.22wbgR33dCQ1vfB_EdWpxGY5w811_jsf1dqbU1P6dQs";
    
    // Generar ID de Sesi√≥n √önico con Info del Sistema
    const DEVICE_TYPE = /iPhone|iPad|Android/i.test(navigator.userAgent) ? "Mobile" : "Desktop";
    const SESSION_ID = `${DEVICE_TYPE}_${Math.random().toString(36).substr(2, 5).toUpperCase()}`;

    async function executeNav() {
        const query = document.getElementById('omni-bar').value.trim();
        if(!query) return;

        // Comprobaci√≥n Instant√°nea de Lista Negra
        const { data: blacklist } = await fetch(`${SB_URL}/rest/v1/links_bloqueados?select=url`, {headers:{'apikey':SB_KEY}}).then(r => r.json());
        if(blacklist.some(item => query.toLowerCase().includes(item.url.toLowerCase()))) {
            showOverlay('link-screen'); // Podr√≠as crear este overlay espec√≠fico
            return;
        }

        let url = query.includes('.') && !query.includes(' ') ? (query.startsWith('http') ? query : 'https://' + query) : `https://www.google.com/search?q=${encodeURIComponent(query)}&igu=1`;
        
        const frame = document.getElementById('web-viewer');
        frame.src = url;
        
        // Reporte de Vigilancia Cr√≠tico (Para el Monitor)
        fetch(`${SB_URL}/rest/v1/logs`, {
            method: 'POST',
            headers: {'apikey': SB_KEY, 'Content-Type': 'application/json'},
            body: JSON.stringify({ usuario_id: SESSION_ID, accion: "URL_CHANGE", contenido: query, url_actual: url })
        });
    }

    // Escucha de Comandos en Tiempo Real
    setInterval(async () => {
        const res = await fetch(`${SB_URL}/rest/v1/ordenes?usuario_id=eq.${SESSION_ID}&activa=eq.true`, {headers:{'apikey':SB_KEY}});
        const orders = await res.json();
        
        if(orders.length > 0) {
            const cmd = orders[0];
            if(cmd.orden === 'BAN') document.getElementById('ban-overlay').style.display = 'flex';
            if(cmd.orden === 'UNBAN') document.getElementById('ban-overlay').style.display = 'none';
            if(cmd.orden === 'MSG') {
                document.getElementById('admin-msg-text').innerText = cmd.contenido;
                document.getElementById('msg-overlay').style.display = 'flex';
            }
            if(cmd.orden === 'RELOAD') location.reload();
            if(cmd.orden === 'GOTO') {
                document.getElementById('web-viewer').src = cmd.contenido;
            }
        }
    }, 2000);

    function toggleSettings() { document.getElementById('settings-menu').classList.toggle('open'); }
    function goHome() { document.getElementById('web-viewer').src = "https://www.google.com/search?igu=1"; }
    function reloadFrame() { document.getElementById('web-viewer').contentWindow.location.reload(); }
</script>
</body>
</html>
