<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AlexNAV Quantum | Ultra Edition</title>
    <style>
        :root { --main: #00d4ff; --bg: #0b0b0e; --glass: rgba(255,255,255,0.05); }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* HEADER ESTILO SAFARI PRO */
        header { 
            height: 65px; background: rgba(13,13,17,0.8); backdrop-filter: blur(20px);
            display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid rgba(255,255,255,0.1); gap: 12px;
        }
        .nav-btn { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .nav-btn:hover { background: var(--main); color: black; }
        
        .omni-container { flex: 1; position: relative; display: flex; align-items: center; }
        .omni-bar { width: 100%; background: #16161d; border: 1px solid #333; color: white; padding: 12px 15px; border-radius: 12px; outline: none; font-size: 14px; transition: 0.3s; }
        .omni-bar:focus { border-color: var(--main); box-shadow: 0 0 15px rgba(0, 212, 255, 0.2); }

        /* VIEWPORT */
        #web-viewport { width: 100%; height: calc(100vh - 66px); border: none; background: white; }

        /* OVERLAYS (BLOQUEOS) */
        .lazarus-screen { position: fixed; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100000; text-align: center; }
        #block-screen { background: #600; color: white; }
        #mute-screen { background: #000; color: var(--main); }
        .timer-circle { font-size: 5rem; font-weight: 800; margin-top: 20px; font-family: monospace; }
    </style>
</head>
<body>

<div id="block-screen" class="lazarus-screen">
    <h1 style="font-size:4rem; margin:0;">BLOQUEADO</h1>
    <p style="letter-spacing:5px;">SISTEMA RESTRINGIDO POR ADMINISTRADOR: ALEX</p>
</div>

<div id="mute-screen" class="lazarus-screen">
    <h2>TIEMPO DE ESPERA ADMINISTRATIVO</h2>
    <div id="mute-timer" class="timer-circle">00:00</div>
</div>

<header>
    <div class="nav-btn" onclick="goHome()">üè†</div>
    <div class="nav-btn" onclick="document.getElementById('web-viewport').contentWindow.location.reload()">‚ü≥</div>
    <div class="omni-container">
        <input type="text" id="omni-in" class="omni-bar" placeholder="Busca o escribe URL..." onkeypress="if(event.key==='Enter') navegar()">
    </div>
    <div class="nav-btn" onclick="alert('Configuraci√≥n: AlexNAV v2.0')">‚öôÔ∏è</div>
</header>

<iframe id="web-viewport" src="https://www.google.com/search?igu=1"></iframe>

<script>
    const SB_URL = "https://gmvczheriaqouwynfdyv.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtdmN6aGVyaWFxb3V3eW5mZHl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MTM1OTQsImV4cCI6MjA4NTk4OTU5NH0.22wbgR33dCQ1vfB_EdWpxGY5w811_jsf1dqbU1P6dQs";
    const USER_ID = (navigator.platform.includes("Win") ? "PC" : "Device") + "_" + Math.floor(Math.random()*899+100);

    async function navegar() {
        const query = document.getElementById('omni-in').value.trim();
        if(!query) return;

        // Comprobaci√≥n de Link Bloqueado (Filtro Lazarus)
        const res = await fetch(`${SB_URL}/rest/v1/links_bloqueados?select=url`, {headers:{'apikey':SB_KEY}});
        const links = await res.json();
        if(links.some(l => query.toLowerCase().includes(l.url.toLowerCase()))) {
            alert("Acceso Denegado: Este link est√° prohibido.");
            return;
        }

        let url = query.includes('.') && !query.includes(' ') ? (query.startsWith('http') ? query : 'https://'+query) : "https://www.google.com/search?q="+encodeURIComponent(query);
        document.getElementById('web-viewport').src = url;
        reportar(query, url);
    }

    async function reportar(c, u) {
        fetch(`${SB_URL}/rest/v1/logs`, {
            method:'POST', headers:{'apikey':SB_KEY, 'Content-Type':'application/json'},
            body: JSON.stringify({usuario_id:USER_ID, accion:"NAV", contenido:c, url_actual:u})
        });
    }

    function goHome() { document.getElementById('web-viewport').src = "https://www.google.com/search?igu=1"; }

    // COMANDOS EN TIEMPO REAL (SIN DELAY)
    setInterval(async () => {
        const res = await fetch(`${SB_URL}/rest/v1/ordenes?usuario_id=eq.${USER_ID}&activa=eq.true`, {headers:{'apikey':SB_KEY}});
        const data = await res.json();
        if(data.length > 0) {
            const o = data[0];
            if(o.orden === 'BAN') document.getElementById('block-screen').style.display = 'flex';
            if(o.orden === 'UNBAN') document.getElementById('block-screen').style.display = 'none';
            if(o.orden === 'MUTE') {
                document.getElementById('mute-screen').style.display = 'flex';
                // L√≥gica de timer aqu√≠ si es necesaria
            }
            if(o.orden === 'UNMUTE') document.getElementById('mute-screen').style.display = 'none';
        }
    }, 1500); // Bajado a 1.5s para menos delay
</script>
</body>
</html>
