<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlexBrowser Ultimate | Premium Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* * ==========================================
         * N칔CLEO CSS - ALEXBROWSER UI ENGINE v10.0 (ULTIMATE)
         * ==========================================
         */

        :root {
            /* PALETA DE COLORES NEON-DARK PREMIUM */
            --bg-app: #09090b;
            --bg-panel: rgba(24, 24, 27, 0.85);
            --bg-input: rgba(39, 39, 42, 0.7);
            --accent: #00f0ff; /* Cyan Neon */
            --accent-glow: rgba(0, 240, 255, 0.5);
            --accent-secondary: #7000ff; /* Purple Neon */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(63, 63, 70, 0.5);
            --danger: #ff0055;
            --success: #00ff88;
            
            /* DIMENSIONES */
            --header-height: 85px;
            --tab-height: 38px;
            --anim-speed: 0.3s;
        }

        /* RESET & BASE CON FONDO ANIMADO */
        * { box-sizing: border-box; user-select: none; outline: none; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            background: linear-gradient(-45deg, #09090b, #1a1a2e, #16213e, #0f3460);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-main);
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* SCROLLBAR PERSONALIZADO */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: var(--accent-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* ==========================================
         * ZONA SUPERIOR (HEADER & TABS)
         * ==========================================
         */
        .browser-chrome {
            background: var(--bg-panel);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border);
            display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            z-index: 100;
        }

        /* BARRA DE PESTA칌AS */
        .tabs-bar {
            height: 42px;
            display: flex; align-items: flex-end;
            padding: 0 10px; gap: 6px;
            background: rgba(0,0,0,0.4);
            overflow-x: auto;
        }
        .tab {
            background: rgba(30, 30, 35, 0.6);
            color: var(--text-muted);
            padding: 10px 18px;
            border-radius: 12px 12px 0 0;
            font-size: 13px;
            display: flex; align-items: center; gap: 10px;
            cursor: pointer;
            transition: all var(--anim-speed) cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 220px; min-width: 130px;
            position: relative;
            border: 1px solid transparent;
            border-bottom: none;
        }
        .tab:hover { 
            background: rgba(50, 50, 60, 0.8); 
            color: var(--text-main); 
        }
        .tab.active {
            background: var(--bg-panel);
            color: var(--text-main);
            border-top: 2px solid var(--accent);
            box-shadow: 0 -4px 15px rgba(0, 240, 255, 0.2);
            font-weight: 600;
            z-index: 2;
        }
        .tab-close {
            margin-left: auto; width: 18px; height: 18px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .tab-close:hover { background: var(--danger); color: white; box-shadow: 0 0 10px var(--danger); }
        
        .new-tab-btn {
            padding: 8px 12px; color: var(--text-muted); cursor: pointer;
            transition: 0.3s; border-radius: 8px; margin-bottom: 4px;
        }
        .new-tab-btn:hover { color: var(--accent); background: rgba(255,255,255,0.1); box-shadow: 0 0 10px var(--accent-glow); }

        /* BARRA DE NAVEGACI칍N (OMNIBOX) */
        .nav-toolbar {
            height: 55px;
            display: flex; align-items: center;
            padding: 0 15px; gap: 12px;
        }

        .nav-controls { display: flex; gap: 6px; }
        .icon-btn {
            width: 36px; height: 36px; border-radius: 10px;
            background: transparent; border: 1px solid transparent;
            color: var(--text-main); cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 15px; transition: all var(--anim-speed);
            position: relative;
        }
        .icon-btn:hover { 
            background: rgba(255,255,255,0.1); 
            color: var(--accent);
            box-shadow: 0 0 12px rgba(255,255,255,0.05);
        }
        .icon-btn:active { transform: scale(0.92); }
        .icon-btn.disabled { color: #555; cursor: not-allowed; pointer-events: none; }

        /* CAJA DE URL INTELIGENTE */
        .omnibox-container {
            flex: 1; position: relative; display: flex; align-items: center;
        }
        .omnibox {
            width: 100%; height: 40px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 0 45px 0 45px;
            color: var(--text-main);
            font-family: 'Segoe UI', monospace; font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }
        .omnibox:focus {
            border-color: var(--accent);
            background: rgba(0,0,0,0.6);
            box-shadow: 0 0 20px var(--accent-glow), inset 0 2px 5px rgba(0,0,0,0.5);
        }
        .site-info-icon {
            position: absolute; left: 16px; 
            color: var(--success); font-size: 14px;
            text-shadow: 0 0 8px var(--success);
        }
        .search-action-icon {
            position: absolute; right: 16px; 
            color: var(--accent); cursor: pointer; font-size: 16px;
            transition: 0.2s;
        }
        .search-action-icon:hover { transform: scale(1.2); text-shadow: 0 0 10px var(--accent); }

        /* ==========================================
         * 츼REA DE VISUALIZACI칍N (VIEWPORT)
         * ==========================================
         */
        .viewport-container {
            flex: 1; position: relative; background: #fff;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5);
        }
        iframe.browser-view {
            width: 100%; height: 100%; border: none; display: none;
            background: #ffffff;
        }
        iframe.browser-view.active { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* PANTALLA DE INICIO (ALEX START PAGE ULTIMATE) */
        .alex-start-page {
            position: absolute; inset: 0;
            background: radial-gradient(circle at center, rgba(30,30,40,0.9) 0%, rgba(0,0,0,1) 100%);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 50;
        }
        .alex-start-page.active { display: flex; animation: fadeIn 0.5s ease; }
        
        .start-logo {
            font-size: 5rem; font-weight: 900;
            background: linear-gradient(to right, #00f0ff, #7000ff, #ff0055);
            -webkit-background-clip: text; color: transparent;
            margin-bottom: 40px; letter-spacing: -2px;
            text-shadow: 0 15px 40px rgba(112, 0, 255, 0.4);
            animation: pulseLogo 3s infinite alternate;
        }

        @keyframes pulseLogo {
            0% { filter: drop-shadow(0 0 10px rgba(0, 240, 255, 0.5)); }
            100% { filter: drop-shadow(0 0 25px rgba(255, 0, 85, 0.6)); }
        }

        .start-search {
            width: 650px; max-width: 90%;
            height: 65px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 35px; padding: 0 35px;
            color: white; font-size: 18px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .start-search:focus {
            background: rgba(0,0,0,0.8);
            border-color: var(--accent);
            transform: scale(1.03) translateY(-5px);
            box-shadow: 0 30px 60px rgba(0, 240, 255, 0.2);
        }
        
        /* ACCESOS R츼PIDOS */
        .quick-links {
            display: flex; gap: 25px; margin-top: 50px;
        }
        .q-link {
            width: 90px; height: 90px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; color: var(--text-muted);
            text-decoration: none; backdrop-filter: blur(5px);
        }
        .q-link:hover { 
            background: rgba(255,255,255,0.1); color: white; 
            transform: translateY(-10px);
            border-color: var(--accent);
            box-shadow: 0 10px 20px var(--accent-glow);
        }
        .q-icon { font-size: 30px; margin-bottom: 12px; }
        .q-text { font-size: 12px; font-weight: 600; letter-spacing: 1px; }

        /* ==========================================
         * PANELES FLOTANTES (AJUSTES, HISTORIAL, ETC)
         * ==========================================
         */
        .overlay-panel {
            position: fixed; top: var(--header-height); right: 0; bottom: 0;
            width: 420px; background: rgba(15, 15, 18, 0.85);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-left: 1px solid rgba(255,255,255,0.1);
            box-shadow: -10px 0 40px rgba(0,0,0,0.8);
            transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 200; display: flex; flex-direction: column;
        }
        .overlay-panel.open { transform: translateX(0); }
        
        .panel-header {
            padding: 25px; border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.3);
        }
        .panel-header h3 { margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px; }
        .panel-content { flex: 1; overflow-y: auto; padding: 25px; }

        /* Men칰 de Opciones Ultimate */
        .menu-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;
        }
        .menu-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 15px; border-radius: 12px; color: white; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            transition: 0.2s;
        }
        .menu-btn:hover { background: rgba(0, 240, 255, 0.1); border-color: var(--accent); color: var(--accent); transform: translateY(-3px); }
        .menu-btn i { font-size: 24px; }

        /* Estilos de Ajustes */
        .setting-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .toggle-switch {
            width: 46px; height: 26px; background: rgba(255,255,255,0.1);
            border-radius: 13px; position: relative; cursor: pointer;
            transition: 0.3s; box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }
        .toggle-switch::after {
            content: ''; position: absolute; left: 3px; top: 3px;
            width: 20px; height: 20px; background: white; border-radius: 50%;
            transition: 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .toggle-switch.active { background: var(--success); box-shadow: 0 0 10px rgba(0, 255, 136, 0.4); }
        .toggle-switch.active::after { left: 23px; }

        /* Lista de Historial */
        .history-item {
            padding: 15px; border-radius: 12px; margin-bottom: 10px;
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            cursor: pointer; display: flex; align-items: center; gap: 15px;
            transition: 0.2s;
        }
        .history-item:hover { background: rgba(255,255,255,0.08); border-color: var(--accent-secondary); transform: translateX(5px); }
        .h-time { font-size: 11px; color: var(--accent); background: rgba(0,240,255,0.1); padding: 4px 8px; border-radius: 6px; }

        /* Notificaciones Toast */
        .toast {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(150px);
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent)); color: white;
            padding: 12px 30px; border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            transition: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
            opacity: 0; font-weight: bold; font-size: 14px; letter-spacing: 1px; z-index: 1000;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    </style>
</head>
<body>

    <div class="browser-chrome">
        <div class="tabs-bar" id="tabs-container">
            </div>

        <div class="nav-toolbar">
            <div class="nav-controls">
                <button class="icon-btn" id="btn-back" onclick="browser.goBack()" title="Atr치s"><i class="fas fa-arrow-left"></i></button>
                <button class="icon-btn" id="btn-forward" onclick="browser.goForward()" title="Adelante"><i class="fas fa-arrow-right"></i></button>
                <button class="icon-btn" onclick="browser.reload()" title="Refrescar"><i class="fas fa-rotate-right"></i></button>
                <button class="icon-btn" onclick="browser.goHome()" title="P치gina Principal"><i class="fas fa-house"></i></button>
            </div>

            <div class="omnibox-container">
                <i class="fas fa-shield-check site-info-icon" title="Conexi칩n Segura"></i>
                <input type="text" class="omnibox" id="url-input" placeholder="Busca en Google o escribe una URL...">
                <i class="fas fa-magnifying-glass search-action-icon" onclick="browser.navigate()" title="Buscar"></i>
            </div>

            <div class="nav-controls">
                <button class="icon-btn" onclick="ui.showToast('Marcador guardado con 칠xito')" title="A침adir Marcador"><i class="fas fa-star"></i></button>
                <button class="icon-btn" onclick="ui.togglePanel('history')" title="Historial"><i class="fas fa-clock-rotate-left"></i></button>
                <button class="icon-btn" onclick="ui.togglePanel('menu')" title="Opciones Ultimate"><i class="fas fa-bars-staggered"></i></button>
            </div>
        </div>
    </div>

    <div class="viewport-container" id="viewport">
        <div class="alex-start-page active" id="start-page">
            <div class="start-logo">AlexBrowser</div>
            <input type="text" class="start-search" placeholder="쯈u칠 quieres descubrir hoy?" onkeypress="if(event.key==='Enter') browser.navigate(this.value)">
            
            <div class="quick-links">
                <a class="q-link" onclick="browser.navigate('wikipedia.org')">
                    <i class="fab fa-wikipedia-w q-icon"></i>
                    <span class="q-text">WIKI</span>
                </a>
                <a class="q-link" onclick="browser.navigate('youtube.com')">
                    <i class="fab fa-youtube q-icon" style="color:#ff0000"></i>
                    <span class="q-text">VIDEOS</span>
                </a>
                <a class="q-link" onclick="browser.navigate('maps.google.com')">
                    <i class="fas fa-map-location-dot q-icon" style="color:#00f0ff"></i>
                    <span class="q-text">MAPAS</span>
                </a>
                <a class="q-link" onclick="browser.navigate('github.com')">
                    <i class="fab fa-github q-icon"></i>
                    <span class="q-text">DEV</span>
                </a>
            </div>
        </div>
        </div>

    <div class="overlay-panel" id="panel-menu">
        <div class="panel-header">
            <h3><i class="fas fa-compass"></i> Opciones de Navegador</h3>
            <button class="icon-btn" onclick="ui.closePanels()"><i class="fas fa-times"></i></button>
        </div>
        <div class="panel-content">
            
            <div class="menu-grid">
                <div class="menu-btn" onclick="ui.togglePanel('history')">
                    <i class="fas fa-history"></i><span>Historial</span>
                </div>
                <div class="menu-btn" onclick="ui.showToast('Abriendo gestor de descargas...')">
                    <i class="fas fa-download"></i><span>Descargas</span>
                </div>
                <div class="menu-btn" onclick="ui.showToast('Abriendo panel de extensiones...')">
                    <i class="fas fa-puzzle-piece"></i><span>Extensiones</span>
                </div>
                <div class="menu-btn" onclick="ui.showToast('Mostrando contrase침as guardadas...')">
                    <i class="fas fa-key"></i><span>Contrase침as</span>
                </div>
                <div class="menu-btn" onclick="window.print()">
                    <i class="fas fa-print"></i><span>Imprimir</span>
                </div>
                <div class="menu-btn" onclick="ui.showToast('Cambiando tema visual...')">
                    <i class="fas fa-palette"></i><span>Temas</span>
                </div>
            </div>

            <h4 style="color:var(--accent); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom:10px;">Privacidad & Seguridad</h4>
            <div class="setting-item">
                <span>Escudo Anti-Rastreo V9</span>
                <div class="toggle-switch active" onclick="this.classList.toggle('active'); ui.showToast('Configuraci칩n actualizada')"></div>
            </div>
            <div class="setting-item">
                <span>Forzar HTTPS Global</span>
                <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
            </div>
            <div class="setting-item">
                <span>Aceleraci칩n por Hardware</span>
                <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
            </div>

            <button style="width:100%; padding:18px; margin-top:30px; background:linear-gradient(45deg, #ff0055, #ff5500); border:none; color:white; border-radius:12px; cursor:pointer; font-weight:bold; font-size:14px; box-shadow: 0 10px 20px rgba(255,0,85,0.3); transition:0.3s;" onclick="dataManager.clearAll()" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <i class="fas fa-trash-can"></i> LIMPIAR DATOS DE NAVEGACI칍N
            </button>
        </div>
    </div>

    <div class="overlay-panel" id="panel-history">
        <div class="panel-header">
            <h3><i class="fas fa-clock-rotate-left"></i> Historial Reciente</h3>
            <button class="icon-btn" onclick="ui.closePanels()"><i class="fas fa-times"></i></button>
        </div>
        <div class="panel-content" id="history-list">
            </div>
    </div>

    <div class="toast" id="toast">Acci칩n completada</div>

<script>
    /**
     * ==========================================
     * ALEXBROWSER CORE - JAVASCRIPT ENGINE ULTIMATE
     * ==========================================
     */

    // --- 1. GESTOR DE DATOS (Persistencia Local) ---
    const dataManager = {
        saveHistory: (url, title) => {
            if(!url || url === 'about:start') return;
            let history = JSON.parse(localStorage.getItem('ab_history') || '[]');
            const entry = { url, title, time: new Date().toLocaleTimeString() };
            history.unshift(entry);
            if(history.length > 50) history.pop(); // Mantener solo 50
            localStorage.setItem('ab_history', JSON.stringify(history));
            ui.renderHistory();
        },
        getHistory: () => {
            return JSON.parse(localStorage.getItem('ab_history') || '[]');
        },
        clearAll: () => {
            localStorage.clear();
            ui.showToast("Todos los datos han sido eliminados.");
            setTimeout(() => location.reload(), 1500);
        }
    };

    // --- 2. MOTOR DE NAVEGACI칍N AVANZADO ---
    class BrowserEngine {
        constructor() {
            this.tabs = [];
            this.activeTabId = null;
            this.idCounter = 0;
            this.homeUrl = 'about:start';
        }

        init() {
            this.newTab();
            document.getElementById('url-input').addEventListener('keypress', (e) => {
                if(e.key === 'Enter') this.navigate();
            });
            ui.renderHistory();
        }

        // Crear nueva pesta침a (con soporte para historial propio)
        newTab(url = this.homeUrl) {
            this.idCounter++;
            const tabId = this.idCounter;
            
            // Estructura de Pesta침a con Historial Real Interno
            const tabData = {
                id: tabId,
                title: 'Nueva Pesta침a',
                url: url,
                history: [url], // Guarda por d칩nde ha pasado esta pesta침a
                historyIndex: 0
            };
            this.tabs.push(tabData);

            const iframe = document.createElement('iframe');
            iframe.className = 'browser-view';
            iframe.id = `view-${tabId}`;
            iframe.setAttribute('allowfullscreen', 'true');
            iframe.setAttribute('allow', 'geolocation; microphone; camera; midi; encrypted-media;');
            document.getElementById('viewport').appendChild(iframe);

            this.activeTabId = tabId;
            this.renderTabs();
            this.updateNavButtons();
            
            if(url !== this.homeUrl) {
                this.navigate(url);
            } else {
                this.switchTab(tabId);
            }
        }

        closeTab(e, id) {
            e.stopPropagation(); 
            if(this.tabs.length === 1) return; 

            this.tabs = this.tabs.filter(t => t.id !== id);
            
            const frame = document.getElementById(`view-${id}`);
            if(frame) frame.remove();

            if(this.activeTabId === id) {
                this.activeTabId = this.tabs[this.tabs.length - 1].id;
            }
            
            this.renderTabs();
            this.switchTab(this.activeTabId);
        }

        switchTab(id) {
            this.activeTabId = id;
            
            document.querySelectorAll('.browser-view').forEach(el => el.classList.remove('active'));
            document.getElementById('start-page').classList.remove('active');

            const currentTab = this.tabs.find(t => t.id === id);
            
            if(currentTab.url === 'about:start') {
                document.getElementById('start-page').classList.add('active');
                document.getElementById('url-input').value = "";
            } else {
                const frame = document.getElementById(`view-${id}`);
                frame.classList.add('active');
                document.getElementById('url-input').value = currentTab.url;
            }

            this.renderTabs();
            this.updateNavButtons();
        }

        // Navegaci칩n Inteligente y Registro de Historial
        navigate(inputVal = null) {
            let query = inputVal || document.getElementById('url-input').value.trim();
            if(!query) return;

            const currentTab = this.tabs.find(t => t.id === this.activeTabId);
            let finalUrl = "";
            const isUrl = query.includes('.') && !query.includes(' ');
            
            if(isUrl) {
                finalUrl = query.startsWith('http') ? query : 'https://' + query;
                currentTab.title = query;
            } else {
                // MOTOR DE B칔SQUEDA: GOOGLE UNRESTRICTED (usando igu=1 para permitir iframe)
                // Esto te permite ver Web, Im치genes, Videos, Maps, etc.
                finalUrl = `https://www.google.com/search?igu=1&q=${encodeURIComponent(query)}`;
                currentTab.title = `游댌 ${query}`;
            }

            // L칩gica para que funcione "Atr치s" y "Adelante"
            // Borramos el historial futuro si navegamos desde un punto anterior
            currentTab.history = currentTab.history.slice(0, currentTab.historyIndex + 1);
            currentTab.history.push(finalUrl);
            currentTab.historyIndex++;
            currentTab.url = finalUrl;
            
            this.loadUrlIntoFrame(finalUrl, currentTab.title);
        }

        // M칠todo auxiliar para cargar en el Iframe
        loadUrlIntoFrame(url, title) {
            document.getElementById('start-page').classList.remove('active');
            const frame = document.getElementById(`view-${this.activeTabId}`);
            frame.classList.add('active');
            frame.src = url;

            document.getElementById('url-input').value = url;
            this.renderTabs();
            this.updateNavButtons();
            dataManager.saveHistory(url, title);
        }

        // FUNCIONES DE NAVEGACI칍N REALES POR PESTA칌A
        goBack() {
            const tab = this.tabs.find(t => t.id === this.activeTabId);
            if(tab && tab.historyIndex > 0) {
                tab.historyIndex--;
                tab.url = tab.history[tab.historyIndex];
                
                if(tab.url === 'about:start') {
                    this.switchTab(tab.id); // Vuelve a la pantalla de inicio
                } else {
                    this.loadUrlIntoFrame(tab.url, "P치gina Anterior");
                }
            }
        }

        goForward() {
            const tab = this.tabs.find(t => t.id === this.activeTabId);
            if(tab && tab.historyIndex < tab.history.length - 1) {
                tab.historyIndex++;
                tab.url = tab.history[tab.historyIndex];
                this.loadUrlIntoFrame(tab.url, "P치gina Siguiente");
            }
        }

        reload() {
            const frame = document.getElementById(`view-${this.activeTabId}`);
            if(frame.src) frame.src = frame.src;
            ui.showToast("P치gina actualizada");
        }

        goHome() {
            const currentTab = this.tabs.find(t => t.id === this.activeTabId);
            currentTab.history.push('about:start');
            currentTab.historyIndex++;
            currentTab.url = 'about:start';
            currentTab.title = 'Inicio';
            this.switchTab(this.activeTabId);
        }

        // Actualiza el estado visual de los botones Atr치s/Adelante
        updateNavButtons() {
            const tab = this.tabs.find(t => t.id === this.activeTabId);
            const btnBack = document.getElementById('btn-back');
            const btnForward = document.getElementById('btn-forward');

            if(tab.historyIndex > 0) btnBack.classList.remove('disabled');
            else btnBack.classList.add('disabled');

            if(tab.historyIndex < tab.history.length - 1) btnForward.classList.remove('disabled');
            else btnForward.classList.add('disabled');
        }

        renderTabs() {
            const container = document.getElementById('tabs-container');
            container.innerHTML = ''; 

            this.tabs.forEach(tab => {
                const tabEl = document.createElement('div');
                tabEl.className = `tab ${tab.id === this.activeTabId ? 'active' : ''}`;
                tabEl.onclick = () => this.switchTab(tab.id);
                
                let icon = tab.url.includes('google.com') ? '<i class="fab fa-google" style="color:#00f0ff"></i>' : '<i class="fas fa-globe"></i>';
                if(tab.url === 'about:start') icon = '<i class="fas fa-house"></i>';

                tabEl.innerHTML = `
                    ${icon}
                    <span style="max-width:110px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;">${tab.title}</span>
                    <div class="tab-close" onclick="browser.closeTab(event, ${tab.id})">&times;</div>
                `;
                container.appendChild(tabEl);
            });

            const newBtn = document.createElement('div');
            newBtn.className = 'new-tab-btn';
            newBtn.innerHTML = '<i class="fas fa-plus"></i>';
            newBtn.onclick = () => this.newTab();
            container.appendChild(newBtn);
        }
    }

    // --- 3. GESTOR DE INTERFAZ (UI) ---
    const ui = {
        togglePanel: (id) => {
            const panel = document.getElementById(`panel-${id}`);
            const isOpen = panel.classList.contains('open');
            ui.closePanels(); 
            if(!isOpen) panel.classList.add('open');
        },
        closePanels: () => {
            document.querySelectorAll('.overlay-panel').forEach(p => p.classList.remove('open'));
        },
        renderHistory: () => {
            const list = dataManager.getHistory();
            const container = document.getElementById('history-list');
            if(list.length === 0) {
                container.innerHTML = '<div style="text-align:center; color:#777; margin-top:30px;"><i class="fas fa-ghost" style="font-size:40px; margin-bottom:15px; display:block;"></i>No hay historial reciente</div>';
                return;
            }
            container.innerHTML = list.map(item => `
                <div class="history-item" onclick="browser.navigate('${item.url}'); ui.closePanels()">
                    <i class="fas fa-link" style="color:var(--accent); font-size:16px;"></i>
                    <div style="flex:1; overflow:hidden;">
                        <div style="font-size:14px; font-weight:bold; white-space:nowrap; text-overflow:ellipsis;">${item.title}</div>
                        <div style="font-size:11px; opacity:0.6; white-space:nowrap; text-overflow:ellipsis;">${item.url}</div>
                    </div>
                    <span class="h-time">${item.time}</span>
                </div>
            `).join('');
        },
        showToast: (msg) => {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
    };

    // INICIALIZACI칍N
    const browser = new BrowserEngine();
    window.onload = () => browser.init();

</script>
</body>
</html>
